import React, { useState, useEffect, useMemo } from 'react';
import { 
  ShoppingCart, X, Star, Lock, Trash2, Plus, Edit2, Truck, 
  CreditCard, Phone, LogOut, Upload, Menu, Minus, Send, 
  Flame, ShieldCheck, Box, ArrowLeft, Heart 
} from 'lucide-react';
import { initializeApp } from "firebase/app";
import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc } from "firebase/firestore";

// ============================================================
// FIREBASE CONFIG
// ============================================================
const firebaseConfig = {
  apiKey: "AIzaSyAu47cciZnYXyEPMTHeH7a1bmX-kCYtGQA",
  authDomain: "conone-757e4.firebaseapp.com",
  projectId: "conone-757e4",
  storageBucket: "conone-757e4.firebasestorage.app",
  messagingSenderId: "960208791384",
  appId: "1:960208791384:web:9e9e109b9df3c1bd95a72d",
  measurementId: "G-B1T6D9BNWN"
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// –î–µ–º–æ-—Ç–æ–≤–∞—Ä–∏ (–¢–µ–º–∞—Ç–∏–∫–∞ 18+) - –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —è–∫—â–æ –±–∞–∑–∞ –ø–æ—Ä–æ–∂–Ω—è –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
const INITIAL_PRODUCTS = [
    { id: '1', name: "–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤–∏ SKYN Elite (10 —à—Ç)", price: 350, category: "–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤–∏", image: "https://m.media-amazon.com/images/I/71Xy8M-zVmL._AC_SL1500_.jpg", rating: 5 },
    { id: '2', name: "–õ—É–±—Ä–∏–∫–∞–Ω—Ç System JO H2O (30 –º–ª)", price: 420, category: "–õ—É–±—Ä–∏–∫–∞–Ω—Ç–∏", image: "https://m.media-amazon.com/images/I/61t+gN-1L+L._AC_SL1500_.jpg", rating: 5 },
    { id: '3', name: "–í—ñ–±—Ä–∞—Ç–æ—Ä Satisfyer Pro 2", price: 1800, category: "–Ü–≥—Ä–∞—à–∫–∏", image: "https://m.media-amazon.com/images/I/61A6-yKqjWL._AC_SL1500_.jpg", rating: 5 },
    { id: '4', name: "–ù–∞–±—ñ—Ä ONE Mixed Pleasures (3 —à—Ç)", price: 99, category: "–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤–∏", image: "https://m.media-amazon.com/images/I/81+Xy-zVmL._AC_SL1500_.jpg", rating: 4 }
];

const POPULAR_CITIES = ["–ö–∏—ó–≤", "–•–∞—Ä–∫—ñ–≤", "–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", "–õ—å–≤—ñ–≤", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–í—ñ–Ω–Ω–∏—Ü—è", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", "–ñ–∏—Ç–æ–º–∏—Ä", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", "–†—ñ–≤–Ω–µ", "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", "–õ—É—Ü—å–∫", "–£–∂–≥–æ—Ä–æ–¥", "–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞"];
const TELEGRAM_BOT_TOKEN = "8490403071:AAFZvriLL_vzQq-ziMVTfiHAu8DmtH84Fjk"; 
const TELEGRAM_CHAT_ID = "7085928669";
const ADMIN_PASSWORD = "toy@56"; 

const App = () => {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [dbError, setDbError] = useState(null);
  const [activePage, setActivePage] = useState('home');
  const [cart, setCart] = useState([]);
  const [isCartOpen, setIsCartOpen] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isAdminMode, setIsAdminMode] = useState(false);
  const [passwordInput, setPasswordInput] = useState("");
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState(null);

  // –î–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
  const [customerName, setCustomerName] = useState("");
  const [customerPhone, setCustomerPhone] = useState("");
  const [customerCity, setCustomerCity] = useState("");
  const [customerBranch, setCustomerBranch] = useState("");
  const [paymentMethod, setPaymentMethod] = useState("cod");
  const [isOrderSending, setIsOrderSending] = useState(false);

  // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Firebase
  useEffect(() => {
    const unsubscribe = onSnapshot(collection(db, "products"), (snapshot) => {
        const productsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setProducts(productsData.length > 0 ? productsData : []); 
        setDbError(null); 
        setLoading(false);
    }, (error) => {
        console.error("DB Error:", error);
        let msg = "–ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.";
        if(error.code === 'permission-denied') msg = "–ù–µ–º–∞—î –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É (–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Rules —É Firebase)";
        setDbError(msg); 
        setProducts(INITIAL_PRODUCTS); // –§–æ–ª–±–µ–∫ –Ω–∞ –¥–µ–º–æ-–¥–∞–Ω—ñ
        setLoading(false);
    });
    return () => unsubscribe();
  }, []);

  const uniqueCategories = useMemo(() => {
    const cats = new Set(products.map(p => p.category).filter(Boolean));
    return Array.from(cats);
  }, [products]);

  const filteredProducts = selectedCategory ? products.filter(p => p.category === selectedCategory) : products;

  // --- ADMIN FUNCTIONS ---
  const addNewProduct = async () => {
    try { 
        await addDoc(collection(db, "products"), { 
            name: "–ù–æ–≤–∏–π –¢–æ–≤–∞—Ä", 
            price: 0, 
            category: uniqueCategories[0] || "–Ü–Ω—à–µ", 
            image: "https://via.placeholder.com/300", 
            rating: 5, 
            createdAt: Date.now() 
        }); 
    } catch(e) { alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è: " + e.message); }
  };

  const updateProductField = async (id, f, v) => { 
      await updateDoc(doc(db, "products", id), { [f]: v }); 
  };

  const removeProduct = async (id) => { 
      if (window.confirm("–í–∏–¥–∞–ª–∏—Ç–∏?")) await deleteDoc(doc(db, "products", id)); 
  };

  const handleFileUpload = (e, id) => {
    const f = e.target.files[0];
    if(f && f.size < 800000) { // < 800KB
        const r = new FileReader(); 
        r.onloadend = () => updateProductField(id, 'image', r.result); 
        r.readAsDataURL(f); 
    } else if(f) alert("–§–æ—Ç–æ –º–∞—î –±—É—Ç–∏ –º–µ–Ω—à–µ 800–ö–±");
  };

  // --- CART FUNCTIONS ---
  const addToCart = (p) => {
    const existing = cart.find(i => i.id === p.id);
    if (existing) setCart(cart.map(i => i.id === p.id ? { ...i, quantity: i.quantity + 1 } : i));
    else setCart([...cart, { ...p, price: Number(p.price)||0, quantity: 1 }]);
    setIsCartOpen(true);
  };

  const updateQty = (id, d) => setCart(cart.map(i => i.id === id ? { ...i, quantity: Math.max(1, i.quantity + d) } : i));
  const removeFromCart = (id) => setCart(cart.filter(i => i.id !== id));
  const totalAmount = cart.reduce((sum, i) => sum + ((Number(i.price)||0) * i.quantity), 0);

  const sendOrder = async (e) => {
    e.preventDefault();
    setIsOrderSending(true);
    const payText = paymentMethod === 'cod' ? 'üì¶ –ù–∞–∫–ª–∞–¥–Ω–∏–π (–ê–Ω–æ–Ω—ñ–º–Ω–æ)' : 'üí≥ –ù–∞ –∫–∞—Ä—Ç—É (–ê–Ω–æ–Ω—ñ–º–Ω–æ)';
    let msg = `<b>üçì –ù–û–í–ï –ó–ê–ú–û–í–õ–ï–ù–ù–Ø!</b>\n\nüë§ ${customerName}\nüìû ${customerPhone}\nüèô ${customerCity}, ‚Ññ${customerBranch}\nüí∞ ${payText}\n\n`;
    cart.forEach((i, idx) => msg += `${idx+1}. ${i.name} (x${i.quantity}) - ${i.price * i.quantity} –≥—Ä–Ω\n`);
    msg += `\nüíµ <b>–°–£–ú–ê: ${totalAmount} –≥—Ä–Ω</b>`;
    
    try {
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: msg, parse_mode: 'HTML' })
        });
        alert(`–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ! –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏. –ê–Ω–æ–Ω—ñ–º–Ω—ñ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç—É—î–º–æ.`);
        setCart([]); 
        setIsCartOpen(false);
    } catch (e) { 
        alert("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏."); 
    } finally { 
        setIsOrderSending(false); 
    }
  };

  const handleLogin = (e) => {
    e.preventDefault();
    if (passwordInput === ADMIN_PASSWORD) { setIsAdminMode(true); setShowLoginModal(false); setPasswordInput(""); } 
    else { alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!"); }
  };

  // --- COMPONENT: Product Card ---
  const ProductCard = ({ p }) => (
    <div className="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border border-purple-50 flex flex-col h-full group overflow-hidden">
        <div className="relative h-64 bg-white p-4 flex items-center justify-center border-b border-purple-50">
            <img src={p.image} alt={p.name} className="w-full h-full object-contain group-hover:scale-105 transition duration-500" />
            <div className="absolute top-0 right-0 bg-violet-600 text-white text-xs font-bold px-3 py-1 rounded-bl-xl">18+</div>
        </div>
        <div className="p-5 flex-1 flex flex-col">
            <div className="text-[10px] text-violet-600 font-bold uppercase mb-2 bg-purple-50 inline-block px-2 py-1 rounded w-fit tracking-wider">{p.category}</div>
            <h3 className="font-bold text-gray-800 leading-tight mb-2 line-clamp-2">{p.name}</h3>
            <div className="mt-auto pt-4 border-t border-gray-50 flex justify-between items-center">
                <span className="text-2xl font-black text-gray-900">{p.price} <span className="text-sm font-medium text-gray-400">–≥—Ä–Ω</span></span>
                <button onClick={() => addToCart(p)} className="bg-violet-600 text-white px-4 py-2.5 rounded-xl hover:bg-violet-800 transition active:scale-95 flex items-center gap-2 shadow-lg shadow-purple-200">
                    <ShoppingCart size={18}/> 
                </button>
            </div>
        </div>
    </div>
  );

  return (
    <div className="min-h-screen flex flex-col relative bg-slate-50 font-sans text-gray-800">
      {/* Styles Injection */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap');
        body { font-family: 'Montserrat', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #7c3aed; border-radius: 10px; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #7c3aed; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      `}</style>

      {/* NAV */}
      <nav className="sticky top-0 z-40 bg-white/90 backdrop-blur-md shadow-sm border-b border-purple-100">
        <div className="max-w-6xl mx-auto px-4">
            <div className="flex justify-between items-center h-16">
                <div className="flex items-center gap-3 cursor-pointer" onClick={() => {setIsAdminMode(false); setActivePage('home')}}>
                    <div className="relative w-10 h-10 flex items-center justify-center bg-violet-600 rounded-xl shadow-lg shadow-purple-200">
                        <Flame className="text-white w-6 h-6" fill="currentColor" />
                    </div>
                    <span className="text-lg md:text-xl font-black tracking-tight text-gray-800">Night<span className="text-violet-600">Secret</span></span>
                    {isAdminMode && <span className="ml-2 bg-violet-600 text-white text-[10px] px-2 py-1 rounded-full font-bold">Admin</span>}
                </div>
                <div className="hidden md:flex gap-8 font-bold text-gray-600 text-sm">
                    <button onClick={() => setActivePage('home')} className="hover:text-violet-600 transition">–ì–æ–ª–æ–≤–Ω–∞</button>
                    <button onClick={() => setActivePage('delivery')} className="hover:text-violet-600 transition">–ê–Ω–æ–Ω—ñ–º–Ω—ñ—Å—Ç—å</button>
                    <button onClick={() => setActivePage('about')} className="hover:text-violet-600 transition">–ü—Ä–æ –Ω–∞—Å</button>
                </div>
                <div className="flex items-center gap-3">
                    {!isAdminMode && <button onClick={() => setIsCartOpen(true)} className="relative px-4 py-2.5 bg-gray-900 text-white rounded-xl hover:bg-gray-800 shadow-lg shadow-gray-200 flex items-center gap-2 transition active:scale-95">
                        <ShoppingCart size={20}/> 
                        {cart.length > 0 && <span className="bg-pink-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center ml-1">{cart.reduce((a,b)=>a+b.quantity,0)}</span>}
                    </button>}
                    {isAdminMode && <button onClick={() => setIsAdminMode(false)} className="p-2.5 rounded-full border bg-red-50 text-red-500 hover:bg-red-100" title="–í–∏–π—Ç–∏"><LogOut size={22}/></button>}
                    {!isAdminMode && <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="md:hidden p-2.5 rounded-full border">{isMobileMenuOpen ? <X size={22}/> : <Menu size={22}/>}</button>}
                </div>
            </div>
        </div>
        {isMobileMenuOpen && !isAdminMode && (
            <div className="md:hidden absolute top-16 left-0 w-full bg-white border-b shadow-xl p-4 flex flex-col gap-4 font-bold text-center text-gray-700 animate-fade-in">
                <button onClick={() => {setActivePage('home'); setIsMobileMenuOpen(false)}}>–ì–æ–ª–æ–≤–Ω–∞</button>
                <button onClick={() => {setActivePage('delivery'); setIsMobileMenuOpen(false)}}>–ê–Ω–æ–Ω—ñ–º–Ω—ñ—Å—Ç—å —Ç–∞ –î–æ—Å—Ç–∞–≤–∫–∞</button>
                <button onClick={() => {setActivePage('about'); setIsMobileMenuOpen(false)}}>–ü—Ä–æ –Ω–∞—Å</button>
            </div>
        )}
      </nav>

      <div className="flex-grow">
        {/* ADMIN MODE */}
        {isAdminMode ? (
            <div className="max-w-6xl mx-auto px-4 py-8 animate-fade-in">
                <div className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <h2 className="text-3xl font-bold text-gray-800">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
                    <button onClick={addNewProduct} className="flex items-center gap-2 bg-violet-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-violet-800 transition"><Plus size={20}/> –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>
                </div>
                {dbError && <div className="bg-red-100 text-red-700 p-4 mb-6 rounded font-bold">–ü–û–ú–ò–õ–ö–ê –ë–ê–ó–ò –î–ê–ù–ò–•: {dbError}</div>}
                {loading ? <div className="loader"></div> : (
                    <div className="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden">
                        {products.length === 0 && <div className="p-12 text-center text-gray-500">–¢–æ–≤–∞—Ä—ñ–≤ –Ω–µ–º–∞—î.</div>}
                        {products.map(p => (
                            <div key={p.id} className="flex items-center gap-4 p-4 border-b border-gray-50 hover:bg-purple-50/30">
                                <div className="relative group w-20 h-20 shrink-0">
                                    <input type="file" id={`upl-${p.id}`} className="hidden" accept="image/*" onChange={(e) => handleFileUpload(e, p.id)}/>
                                    <div className="w-full h-full rounded-xl bg-gray-50 border cursor-pointer overflow-hidden flex items-center justify-center" onClick={() => document.getElementById(`upl-${p.id}`).click()}>
                                        <img src={p.image} className="w-full h-full object-contain" alt="" />
                                        <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><Upload className="text-white" size={20}/></div>
                                    </div>
                                </div>
                                <div className="flex-1 w-full space-y-2">
                                    <input value={p.name} onChange={(e) => updateProductField(p.id, 'name', e.target.value)} className="w-full font-bold bg-transparent focus:bg-white rounded px-2 outline-none border border-transparent focus:border-purple-300"/>
                                    <div className="relative">
                                        <input list={`tags-${p.id}`} value={p.category} onChange={(e) => updateProductField(p.id, 'category', e.target.value)} className="text-sm bg-gray-50 rounded px-2 py-1 w-full outline-none border border-transparent focus:border-purple-300" placeholder="–ö–∞—Ç–µ–≥–æ—Ä—ñ—è"/>
                                        <datalist id={`tags-${p.id}`}>{uniqueCategories.map(c=><option key={c} value={c}/>)}</datalist>
                                    </div>
                                </div>
                                <input type="number" value={p.price} onChange={(e) => updateProductField(p.id, 'price', Number(e.target.value))} className="w-24 font-bold text-violet-600 bg-transparent focus:bg-white rounded px-2 outline-none"/>
                                <button onClick={() => removeProduct(p.id)} className="p-2 text-red-400 hover:bg-red-100 rounded-lg"><Trash2 size={20}/></button>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        ) : activePage === 'delivery' ? (
            <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in">
                <h1 className="text-3xl font-extrabold text-center mb-10 text-gray-800">100% –ê–Ω–æ–Ω—ñ–º–Ω—ñ—Å—Ç—å —Ç–∞ –î–æ—Å—Ç–∞–≤–∫–∞</h1>
                <div className="grid md:grid-cols-2 gap-8">
                    <div className="bg-white p-8 rounded-3xl shadow-lg border border-purple-50">
                        <div className="bg-purple-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 text-violet-600"><ShieldCheck size={32}/></div>
                        <h2 className="text-xl font-bold mb-4">–ü–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å</h2>
                        <ul className="space-y-3 text-sm text-gray-600">
                            <li className="flex items-center gap-2"><Box size={16}/> –£–ø–∞–∫–æ–≤–∫–∞ –±–µ–∑ –Ω–∞–ø–∏—Å—ñ–≤</li>
                            <li className="flex items-center gap-2"><Lock size={16}/> –û–ø–∏—Å: "–ö–æ—Å–º–µ—Ç–∏–∫–∞"</li>
                            <li className="flex items-center gap-2"><Truck size={16}/> –®–≤–∏–¥–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞</li>
                        </ul>
                    </div>
                    <div className="bg-white p-8 rounded-3xl shadow-lg border border-purple-50">
                        <div className="bg-green-100 w-16 h-16 rounded-2xl flex items-center justify-center mb-6 text-green-600"><CreditCard size={32}/></div>
                        <h2 className="text-xl font-bold mb-4">–û–ø–ª–∞—Ç–∞</h2>
                        <ul className="space-y-3 text-gray-600 text-sm">
                            <li>üíµ <b>–ù–∞–∫–ª–∞–¥–Ω–∏–π:</b> –ü—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ</li>
                            <li>üí≥ <b>–ö–∞—Ä—Ç–∞:</b> Mono/Privat</li>
                        </ul>
                    </div>
                </div>
            </div>
        ) : activePage === 'about' ? (
            <div className="max-w-4xl mx-auto px-4 py-12 animate-fade-in text-center">
                <div className="bg-white rounded-[2.5rem] p-12 shadow-xl border border-purple-50 relative overflow-hidden">
                    <div className="relative z-10">
                        <div className="w-24 h-24 bg-violet-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl shadow-purple-200"><Flame size={40} className="text-white"/></div>
                        <h1 className="text-3xl md:text-4xl font-extrabold text-gray-800 mb-6">Night Secret</h1>
                        <p className="text-lg text-gray-600 leading-relaxed mb-8 max-w-2xl mx-auto">–¢–≤—ñ–π –ø—Ä–æ—Å—Ç—ñ—Ä –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è.</p>
                    </div>
                    <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-violet-600 to-pink-600"></div>
                </div>
            </div>
        ) : (
            // HOME PAGE
            <div className="max-w-6xl mx-auto px-4 py-8">
                <div className="bg-gradient-to-r from-violet-600 to-violet-900 rounded-[2.5rem] p-8 md:p-16 mb-12 text-white shadow-2xl relative overflow-hidden text-center md:text-left flex items-center">
                    <div className="relative z-10 max-w-2xl">
                        <span className="inline-block bg-white/10 backdrop-blur-md px-4 py-2 rounded-lg text-sm font-bold uppercase mb-6 border border-white/20 tracking-widest">–ê–Ω–æ–Ω—ñ–º–Ω–æ ‚Ä¢ –®–≤–∏–¥–∫–æ</span>
                        <h1 className="text-4xl md:text-6xl font-extrabold mb-6 leading-tight">–¢–µ—Ä–∏—Ç–æ—Ä—ñ—è —Ç–≤–æ–≥–æ <br/><span className="text-pink-600">–∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è</span></h1>
                        <p className="text-lg opacity-80 mb-8 max-w-lg">–ù–∞–π–∫—Ä–∞—â—ñ —Ç–æ–≤–∞—Ä–∏ –¥–ª—è –Ω–µ–∑–∞–±—É—Ç–Ω—ñ—Ö –º–æ–º–µ–Ω—Ç—ñ–≤.</p>
                        <button onClick={()=>document.getElementById('catalog').scrollIntoView({behavior:'smooth'})} className="bg-white text-violet-600 px-8 py-4 rounded-xl font-bold hover:bg-gray-100 transition shadow-lg flex items-center gap-2 w-fit mx-auto md:mx-0">–î–æ –∫–∞—Ç–∞–ª–æ–≥—É <ArrowLeft className="rotate-180"/></button>
                    </div>
                    <div className="absolute -right-20 -bottom-40 w-96 h-96 bg-pink-600 blur-[100px] opacity-50 rounded-full"></div>
                </div>
                
                <div id="catalog" className="mb-8">
                    <div className="flex flex-wrap gap-2 justify-center md:justify-start">
                        <button onClick={()=>setSelectedCategory(null)} className={`px-5 py-2.5 rounded-xl text-sm font-bold transition ${selectedCategory===null ? 'bg-gray-900 text-white' : 'bg-white text-gray-600 border hover:border-violet-600'}`}>–í—Å—ñ</button>
                        {uniqueCategories.map(c=><button key={c} onClick={()=>setSelectedCategory(c)} className={`px-5 py-2.5 rounded-xl text-sm font-bold transition ${selectedCategory===c ? 'bg-violet-600 text-white shadow-lg shadow-purple-200' : 'bg-white text-gray-600 border hover:border-violet-600'}`}>{c}</button>)}
                    </div>
                </div>
                
                {loading ? <div className="loader"></div> : (
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-16">
                        {filteredProducts.length===0 && <div className="col-span-full text-center text-gray-400 py-10">–¢–æ–≤–∞—Ä—ñ–≤ –Ω–µ–º–∞—î.</div>}
                        {filteredProducts.map(p => <ProductCard key={p.id} p={p}/>)}
                    </div>
                )}
            </div>
        )}
      </div>

      {!isAdminMode && (
        <footer className="bg-gray-900 text-gray-300 pt-16 pb-8 mt-auto rounded-t-[3rem]">
            <div className="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
                <div><div className="flex items-center gap-2 mb-4"><div className="w-8 h-8 flex items-center justify-center bg-violet-600 rounded-lg"><Flame className="text-white w-5 h-5" fill="currentColor" /></div><span className="text-xl font-bold text-white">Night<span className="text-violet-600">Secret</span></span></div><p className="text-sm mt-4 text-gray-400">–¢–≤—ñ–π —Å–µ–∫—Ä–µ—Ç —É –±–µ–∑–ø–µ—Ü—ñ.</p></div>
                <div><h3 className="text-white font-bold mb-6">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3><ul className="space-y-3 text-sm"><li><button onClick={() => setActivePage('delivery')} className="hover:text-violet-600 transition flex items-center gap-2"><ShieldCheck size={16}/> –ê–Ω–æ–Ω—ñ–º–Ω—ñ—Å—Ç—å</button></li><li><button onClick={() => setActivePage('about')} className="hover:text-violet-600 transition flex items-center gap-2"><Heart size={16}/> –ü—Ä–æ –Ω–∞—Å</button></li></ul></div>
                <div><h3 className="text-white font-bold mb-6">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3><ul className="space-y-3 text-sm"><li className="flex items-center gap-3"><Phone size={18} className="text-violet-600"/> +38 (097) 123 45 67</li><li className="flex items-center gap-3"><Send size={18} className="text-violet-600"/> @night_secret_ua</li><li className="text-xs text-gray-500 mt-2">18+</li></ul></div>
            </div>
            <div className="max-w-6xl mx-auto px-4 pt-8 mt-8 border-t border-gray-800 text-xs text-gray-500 flex justify-between items-center"><p>¬© 2024 Night Secret.</p><button onClick={() => setShowLoginModal(true)} className="bg-white/5 hover:bg-white/20 text-gray-500 hover:text-white p-2 rounded-full transition"><Lock size={14}/></button></div>
        </footer>
      )}

      {showLoginModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/40 backdrop-blur-md" onClick={() => setShowLoginModal(false)}>
            <div className="bg-white rounded-[2rem] shadow-2xl p-8 max-w-sm w-full relative" onClick={e => e.stopPropagation()}>
                <h3 className="text-2xl font-extrabold text-center mb-6 text-gray-800">–í—Ö—ñ–¥ Admin</h3>
                <form onSubmit={handleLogin}>
                    <input type="password" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} className="w-full px-5 py-4 rounded-xl bg-gray-50 border-2 font-bold text-center text-lg mb-6 outline-none focus:border-violet-600" placeholder="–ü–∞—Ä–æ–ª—å" autoFocus />
                    <button className="w-full bg-violet-600 text-white py-4 rounded-xl font-bold hover:bg-violet-800 transition">–£–≤—ñ–π—Ç–∏</button>
                </form>
            </div>
        </div>
      )}

      {isCartOpen && !isAdminMode && (
        <div className="fixed inset-0 z-50 flex justify-end">
            <div className="absolute inset-0 bg-gray-900/50 backdrop-blur-sm" onClick={() => setIsCartOpen(false)}></div>
            <div className="w-full max-w-md bg-[#f8fafc] h-full shadow-2xl flex flex-col relative animate-fade-in ml-auto z-50">
                <div className="px-6 py-5 border-b border-purple-100 flex justify-between items-center bg-white">
                    <h2 className="text-xl font-bold flex gap-2 items-center"><ShoppingCart className="text-violet-600"/> –ö–æ—à–∏–∫ <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500 font-normal">–ê–Ω–æ–Ω—ñ–º–Ω–∞ —É–ø–∞–∫–æ–≤–∫–∞</span></h2>
                    <button onClick={() => setIsCartOpen(false)} className="p-2 hover:bg-gray-100 rounded-full transition"><X size={20}/></button>
                </div>
                <div className="flex-1 overflow-auto p-4">
                    {cart.length === 0 ? <div className="text-center text-gray-500 mt-10">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π...</div> : (
                        <>
                        <div className="space-y-4 mb-8">
                            {cart.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-purple-50 flex gap-4">
                                    <img src={item.image} className="w-16 h-16 object-contain bg-gray-50 rounded-lg" alt={item.name}/>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start"><div className="font-bold text-sm text-gray-800 line-clamp-1">{item.name}</div><button onClick={() => removeFromCart(item.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={16}/></button></div>
                                        <div className="flex justify-between items-end mt-2">
                                            <div className="font-bold text-violet-600">{item.price} –≥—Ä–Ω</div>
                                            <div className="flex items-center gap-1 bg-gray-50 rounded-lg border p-0.5">
                                                <button onClick={() => updateQty(item.id, -1)} className="p-1 hover:bg-white rounded"><Minus size={16}/></button>
                                                <span className="font-bold min-w-[20px] text-center text-sm">{item.quantity}</span>
                                                <button onClick={() => updateQty(item.id, 1)} className="p-1 hover:bg-white rounded"><Plus size={16}/></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        <div className="bg-white p-6 rounded-3xl shadow-sm border border-purple-100 space-y-4">
                            <h3 className="font-bold mb-4 flex gap-2"><Edit2 className="text-violet-600" size={16}/> –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è (–ê–Ω–æ–Ω—ñ–º–Ω–æ)</h3>
                            <form onSubmit={sendOrder} className="space-y-3">
                                <input required value={customerName} onChange={e => setCustomerName(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border focus:border-violet-600 outline-none" placeholder="–ü–Ü–ë"/>
                                <input required type="tel" value={customerPhone} onChange={e => setCustomerPhone(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border focus:border-violet-600 outline-none" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"/>
                                <div className="bg-gray-50 p-3 rounded-xl border border-gray-200">
                                    <div className="text-xs font-bold text-red-600 mb-2 flex gap-1"><Truck size={12}/> –ù–æ–≤–∞ –ü–æ—à—Ç–∞</div>
                                    <input list="cities" required value={customerCity} onChange={e => setCustomerCity(e.target.value)} className="w-full px-3 py-2 rounded-lg border mb-2 text-sm focus:border-red-500 outline-none" placeholder="–ú—ñ—Å—Ç–æ"/>
                                    <datalist id="cities">{POPULAR_CITIES.map(c => <option key={c} value={c}/>)}</datalist>
                                    <input required value={customerBranch} onChange={e => setCustomerBranch(e.target.value)} className="w-full px-3 py-2 rounded-lg border text-sm focus:border-red-500 outline-none" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è ‚Ññ"/>
                                </div>
                                <div className="bg-gray-50 p-3 rounded-xl border border-gray-200">
                                    <div className="text-xs font-bold text-green-600 mb-2 flex gap-1"><CreditCard size={12}/> –û–ø–ª–∞—Ç–∞</div>
                                    <label className="flex items-center gap-2 p-2 hover:bg-white cursor-pointer"><input type="radio" name="pay" checked={paymentMethod==='cod'} onChange={()=>setPaymentMethod('cod')} className="text-violet-600 focus:ring-violet-600"/><span className="text-sm">–ù–∞–∫–ª–∞–¥–Ω–∏–π</span></label>
                                    <label className="flex items-center gap-2 p-2 hover:bg-white cursor-pointer"><input type="radio" name="pay" checked={paymentMethod==='card'} onChange={()=>setPaymentMethod('card')} className="text-violet-600 focus:ring-violet-600"/><span className="text-sm">–ù–∞ –∫–∞—Ä—Ç—É</span></label>
                                </div>
                                <div className="pt-4 mt-4 border-t border-dashed flex justify-between items-center">
                                    <div className="text-xl font-black">–°—É–º–∞: <span className="text-violet-600">{totalAmount} –≥—Ä–Ω</span></div>
                                    <button disabled={isOrderSending} className="bg-violet-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-violet-800 transition flex items-center gap-2 shadow-lg shadow-purple-200 active:scale-95">{isOrderSending ? '...' : <><Send size={18}/> –ó–∞–º–æ–≤–∏—Ç–∏</>}</button>
                                </div>
                            </form>
                        </div>
                        </>
                    )}
                </div>
            </div>
        </div>
      )}
    </div>
  );
};

export default App;
